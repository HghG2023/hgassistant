<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>任务管理系统</title>
<!-- 引入 Firebase JavaScript SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.5/firebase-database.js"></script>
<script>
  // 初始化 Firebase
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  // 获取 Realtime Database 引用
  const database = firebase.database();

  // 当用户点击保存按钮时，将用户输入的数据写入数据库
  function onSaveButtonClick() {
    const taskTime = {
      start_time: {
        one: "默认当前时间开始",
        two: "从未来某时间点开始"
      },
      end_time: document.getElementById("end_time").value
    };
    const location = {
      simple_location: document.getElementById("simple_location").value,
      complex_location: document.getElementById("complex_location").value
    };
    const taskContent = {
      brief_description: document.getElementById("brief_description").value,
      detailed_description: document.getElementById("detailed_description").value,
      other_description: document.getElementById("other_description").value
    };
    const taskEconomicStructure = {
      estimated_expenses: document.getElementById("estimated_expenses").value,
      regular_plan_expenses: document.getElementById("regular_plan_expenses").value,
      estimated_income: document.getElementById("estimated_income").value,
      total_amount: document.getElementById("total_amount").value,
      balance: document.getElementById("balance").value,
      phase_plan_balance: document.getElementById("phase_plan_balance").value.split(",")
    };

    const taskData = {
      task_time: taskTime,
      location: location,
      task_content: taskContent,
      task_economic_structure: taskEconomicStructure
    };

    database.ref('tasks/').push(taskData)
      .then(() => {
        console.log("数据成功写入 Firebase!");
        alert("任务保存成功!");
      })
      .catch((error) => {
        console.error("写入数据到 Firebase 出错: ", error);
        alert("保存任务失败。请重试。");
      });
  }

  // 当用户点击读取按钮时，从数据库读取任务数据
  function onReadButtonClick() {
    database.ref('tasks/').once('value').then((snapshot) => {
      const tasksData = snapshot.val();
      console.log("从 Firebase 读取的任务数据:", tasksData);
      document.getElementById("display_data").innerText = JSON.stringify(tasksData, null, 2);
    });
  }
</script>
</head>
<body>
<h1>任务管理系统</h1>

<!-- 左侧保存任务数据区域 -->
<div style="float: left; width: 50%;">
  <h2>保存任务数据</h2>
  <form onsubmit="event.preventDefault(); onSaveButtonClick()">
    <!-- 输入表单 -->
  </form>
</div>

<!-- 右侧读取任务数据区域 -->
<div style="float: right; width: 50%;">
  <h2>读取任务数据</h2>
  <button onclick="onReadButtonClick()">读取任务数据</button>

  <!-- 显示读取的任务数据 -->
  <h3>显示任务数据:</h3>
  <pre id="display_data"></pre>
</div>

</body>
</html>
